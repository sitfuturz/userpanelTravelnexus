<div class="growth-meet-container">
  <!-- Header Section -->
  <div class="growth-meet-header">
    <h1 class="page-title">Growth Meet</h1>
    <div class="header-controls">
      <div class="tab-container">
        <button 
          class="tab-btn" 
          [class.active]="activeTab === 'initiated'"
          (click)="switchTab('initiated')">
          Initiated by you
        </button>
        <button 
          class="tab-btn" 
          [class.active]="activeTab === 'others'"
          (click)="switchTab('others')">
          Initiated by other
        </button>
      </div>
      <button class="add-btn" (click)="openGrowthMeetModal()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 5v14M5 12h14"/>
        </svg>
        Add
      </button>
    </div>
  </div>

  <!-- Growth Meets Container -->
  <div class="growth-meets-container">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="spinner"></div>
      <p>Loading growth meets...</p>
    </div>

    <!-- Growth Meets List -->
    <div *ngIf="!isLoading" class="growth-meets-list">
      <div 
        *ngFor="let growthMeet of currentGrowthMeets; let i = index" 
        class="growth-meet-card"
        (click)="openDetailModal(growthMeet)">
        
        <!-- Member Info -->
        <div class="member-section">
          <img 
            [src]="imageUrl+getMemberAvatar(growthMeet)"
            [alt]="getMemberName(growthMeet)"
            class="member-avatar"
            onerror="this.src='assets/images/placeholder-image.png'">
          <div class="member-details">
            <h3 class="member-name">{{ getMemberName(growthMeet) }}</h3>
            <p class="initiated-by">Initiated by: {{ growthMeet.initiatedBy?.name }}</p>
          </div>
        </div>

        <!-- Date -->
        <div class="date-section">
          <span class="date-text">{{ growthMeet.date | date:'yyyy-MM-dd' }}</span>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="currentGrowthMeets.length === 0" class="empty-state">
        <div class="empty-icon">ü§ù</div>
        <h3>No growth meets {{ activeTab === 'initiated' ? 'initiated by you' : 'from others' }} yet.</h3>
        <p *ngIf="activeTab === 'initiated'">Start creating growth meets by clicking the Add button!</p>
        <p *ngIf="activeTab === 'others'">No one has initiated a growth meet with you yet.</p>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!isLoading && currentGrowthMeets.length > 0" class="pagination-container">
    <div class="pagination">
      <button 
        class="pagination-btn" 
        [disabled]="currentPage <= 1"
        (click)="goToPage(currentPage - 1)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15,18 9,12 15,6"/>
        </svg>
      </button>
      <button 
        *ngFor="let page of paginationPages"
        class="pagination-btn"
        [class.active]="page === currentPage"
        (click)="goToPage(page)">
        {{ page }}
      </button>
      <button 
        class="pagination-btn" 
        [disabled]="currentPage >= totalPages"
        (click)="goToPage(currentPage + 1)">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="9,18 15,12 9,6"/>
        </svg>
      </button>
    </div>
    <div class="pagination-info">
      Page {{ currentPage }} of {{ totalPages }}
    </div>
  </div>

  <!-- Floating Add Button (Mobile) -->
  <button class="floating-add-btn" (click)="openGrowthMeetModal()">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M12 5v14M5 12h14"/>
    </svg>
  </button>
</div>

<!-- Detail Modal -->
<div *ngIf="showDetailModal" class="modal-overlay" (click)="closeDetailModal()">
  <div class="modal-container detail-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="modal-title-section">
        <h2>Growth Meet Details</h2>
        <div class="modal-meta">
          <span class="initiated-label">Initiated By: <strong>{{ selectedGrowthMeet?.initiatedBy?.name }}</strong></span>
          <span class="date-label">{{ selectedGrowthMeet?.date | date:'d MMM yyyy' }}</span>
        </div>
      </div>
      <button class="close-btn" (click)="closeDetailModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    
    <div class="modal-body">
      <!-- Member 1 -->
      <div class="member-info-section">
        <span class="section-label">Member 1:</span>
        <div class="member-info">
          <img 
             [src]="selectedGrowthMeet?.memberId1?.profilePic 
    ? environment.imageUrl + selectedGrowthMeet?.memberId1?.profilePic 
    : 'assets/images/placeholder-image.png'"
            [alt]="selectedGrowthMeet?.memberId1?.name"
            class="member-detail-avatar"
            onerror="this.src='assets/images/placeholder-image.png'">
          <div class="member-text">
            <span class="member-detail-name">{{ selectedGrowthMeet?.memberId1?.name }}</span>
            <span class="member-designation">{{ selectedGrowthMeet?.memberId1?.designation || 'Member' }}</span>
          </div>
        </div>
      </div>

      <!-- Member 2 -->
      <div class="member-info-section">
        <span class="section-label">Member 2:</span>
        <div class="member-info">
          <img 
            [src]="imageUrl+selectedGrowthMeet?.memberId2?.profilePic || 'assets/images/placeholder-image.png'"
            [alt]="selectedGrowthMeet?.memberId2?.name"
            class="member-detail-avatar"
            onerror="this.src='assets/images/placeholder-image.png'">
          <div class="member-text">
            <span class="member-detail-name">{{ selectedGrowthMeet?.memberId2?.name }}</span>
            <span class="member-designation">{{ selectedGrowthMeet?.memberId2?.designation || 'Member' }}</span>
          </div>
        </div>
      </div>

      <!-- Photo Section -->
      <div class="photo-section" *ngIf="selectedGrowthMeet?.photo">
        <span class="section-label">Photo:</span>
        <div class="photo-container">
<img [src]="imageUrl+selectedGrowthMeet?.photo" [alt]="'Growth meet photo'" class="growth-meet-photo" onerror="this.src='assets/images/placeholder-image.png'">        </div>
      </div>

      <!-- Connection Details -->
      <div class="connection-details-section">
        <span class="section-label">Connection Details:</span>
        
        <div class="detail-item">
          <span class="detail-label">Where did you meet?</span>
          <span class="detail-value">{{ selectedGrowthMeet?.meet_place || 'Not specified' }}</span>
        </div>
        
        <div class="detail-item">
          <span class="detail-label">Topics of conversation</span>
          <span class="detail-value">{{ selectedGrowthMeet?.topics || 'Not specified' }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Create Growth Meet Modal -->
<div *ngIf="showGrowthMeetModal" class="modal-overlay" (click)="closeGrowthMeetModal()">
  <div class="modal-container create-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Growth Meet</h2>
      <button class="close-btn" (click)="closeGrowthMeetModal()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <form [formGroup]="growthMeetForm" (ngSubmit)="onSubmitGrowthMeet()">
        
        <!-- Photo Upload -->
        <div class="form-section">
          <label class="section-label">Photo (Optional)</label>
          <div class="photo-upload-container" (click)="fileInput.click()">
            <div class="photo-upload-area" *ngIf="!selectedPhoto">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                <circle cx="12" cy="13" r="4"/>
                <path d="M12 10v6M9 13h6"/>
              </svg>
              <span class="upload-text">Add Photo</span>
            </div>
            <div class="photo-preview" *ngIf="selectedPhoto">
              <img [src]="photoPreviewUrl" alt="Selected photo" class="preview-image">
            </div>
          </div>
          <input #fileInput type="file" accept="image/*" (change)="onPhotoSelected($event)" style="display: none;">
        </div>

        <!-- Selected Member Display -->
        <div class="form-section" *ngIf="selectedMember">
          <div class="selected-member-display">
            <img 
              [src]="selectedMember.profilePic || 'assets/images/placeholder-image.png'"
              [alt]="selectedMember.name"
              class="selected-member-avatar"
              onerror="this.src='assets/images/placeholder-image.png'">
            <div class="selected-member-info">
              <span class="selected-member-name">{{ selectedMember.name }}</span>
              <span class="selected-member-chapter">{{ selectedMember.chapter_name }}</span>
            </div>
            <button type="button" class="remove-member-btn" (click)="removeMember()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Member Selection -->
        <div class="form-section" *ngIf="!selectedMember">
          <label class="section-label">
            Select Member <span class="required">*</span>
          </label>
          <div class="searchable-dropdown">
            <input 
              type="text" 
              #memberSearch 
              class="form-input search-input"
              placeholder="Search and select a member..."
              (input)="onMemberSearch($event)"
              (focus)="onMemberFocus()"
              (blur)="onMemberBlur()"
              [value]="selectedMemberDisplay">
            <div class="dropdown-list" [class.show]="showMemberDropdown">
              <div 
                *ngFor="let user of filteredUsers" 
                class="dropdown-item"
                (mousedown)="selectMember(user)">
                {{ user.name }} - {{ user.chapter_name || 'N/A' }}
              </div>
              <div *ngIf="filteredUsers.length === 0 && memberSearchTerm" class="dropdown-item no-results">
                No members found matching "{{ memberSearchTerm }}"
              </div>
              <div *ngIf="filteredUsers.length === 0 && !memberSearchTerm" class="dropdown-item no-results">
                No members available
              </div>
            </div>
          </div>
          <div *ngIf="isLoadingUsers" class="loading-text">Loading members...</div>
          <div *ngIf="growthMeetForm.get('memberId')?.invalid && growthMeetForm.get('memberId')?.touched" class="error-text">
            Please select a member
          </div>
        </div>

        <!-- Initiated By -->
        <div class="form-section">
          <label class="section-label">
            Initiated By <span class="required">*</span>
          </label>
          <div class="dropdown-container">
            <select formControlName="initiatedBy" class="form-select">
              <option value="myself">By Myself</option>
              <option value="member">By Member</option>
            </select>
            <svg class="dropdown-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6,9 12,15 18,9"/>
            </svg>
          </div>
          <div *ngIf="growthMeetForm.get('initiatedBy')?.invalid && growthMeetForm.get('initiatedBy')?.touched" class="error-text">
            Please select who initiated the growth meet
          </div>
        </div>

        <!-- Where did you meet -->
        <div class="form-section">
          <label class="section-label">
            Where did you meet? <span class="required">*</span>
          </label>
          <input 
            type="text" 
            formControlName="location" 
            placeholder="Enter location where you met"
            class="form-input"
            [class.error]="growthMeetForm.get('location')?.invalid && growthMeetForm.get('location')?.touched">
          <div *ngIf="growthMeetForm.get('location')?.invalid && growthMeetForm.get('location')?.touched" class="error-text">
            Please enter where you met
          </div>
        </div>

        <!-- Date -->
        <div class="form-section">
          <label class="section-label">
            Date <span class="required">*</span>
          </label>
          <div class="date-input-container">
            <input 
              type="date" 
              formControlName="date" 
              class="form-input date-input"
              [class.error]="growthMeetForm.get('date')?.invalid && growthMeetForm.get('date')?.touched">
            <svg class="date-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
              <line x1="16" y1="2" x2="16" y2="6"/>
              <line x1="8" y1="2" x2="8" y2="6"/>
              <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
          </div>
          <div *ngIf="growthMeetForm.get('date')?.invalid && growthMeetForm.get('date')?.touched" class="error-text">
            Please select the date
          </div>
        </div>

        <!-- Topics of conversation -->
        <div class="form-section">
          <label class="section-label">
            Topics of conversation <span class="required">*</span>
          </label>
          <textarea 
            formControlName="topics" 
            placeholder="Describe what you talked about..."
            class="form-textarea"
            [class.error]="growthMeetForm.get('topics')?.invalid && growthMeetForm.get('topics')?.touched"></textarea>
          <div *ngIf="growthMeetForm.get('topics')?.invalid && growthMeetForm.get('topics')?.touched" class="error-text">
            Please describe the topics of conversation
          </div>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
          <button type="submit" class="btn-confirm" [disabled]="growthMeetForm.invalid || isSubmitting">
            <span *ngIf="!isSubmitting">Confirm</span>
            <span *ngIf="isSubmitting">Creating...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>